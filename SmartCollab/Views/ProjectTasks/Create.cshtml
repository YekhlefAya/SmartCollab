@using Microsoft.AspNetCore.Mvc.Rendering
@using SmartCollab.Models

@model ProjectTaskCreateViewModel

@{
    ViewData["Title"] = "Nouvelle tâche";
    ViewData["Breadcrumb"] = new List<(string, string)>
    {
        ("Accueil", "/"),
        ("Tâches", "/Tasks"),
        ("Nouvelle", "")
    };

    // Dictionnaire de traduction pour Priority
    var priorityTranslations = new Dictionary<string, string>
    {
        { "Low", "Basse" },
        { "Medium", "Moyenne" },
        { "High", "Haute" }
    };

    // Dictionnaire de traduction pour TaskStatus (seulement les 3 statuts principaux)
    var statusTranslations = new Dictionary<string, string>
    {
        { "NotStarted", "Non débuté" },
        { "InProgress", "En cours" },
        { "Completed", "Terminé" }
    };

    // Préparer les SelectList pour Priorité avec traduction
    var priorityList = Enum.GetValues(typeof(Priority))
                           .Cast<Priority>()
                           .Select(p => new SelectListItem
                           {
                               Value = p.ToString(),
                               Text = priorityTranslations.ContainsKey(p.ToString()) ? 
                                      priorityTranslations[p.ToString()] : p.ToString(),
                               Selected = p == Model.Priority
                           }).ToList();

    // Préparer les SelectList pour Statut avec traduction
    var statusList = Enum.GetValues(typeof(SmartCollab.Models.TaskStatus))
                         .Cast<SmartCollab.Models.TaskStatus>()
                         .Select(s => new SelectListItem
                         {
                             Value = s.ToString(),
                             Text = statusTranslations.ContainsKey(s.ToString()) ? 
                                    statusTranslations[s.ToString()] : s.ToString(),
                             Selected = s == Model.Status
                         })
                         .Where(s => statusTranslations.ContainsKey(s.Value)) // Filtrer seulement les 3 statuts
                         .ToList();
}

<div class="max-w-3xl mx-auto">
    <div class="bg-white rounded-2xl shadow-sm p-8">
        <h2 class="text-xl font-bold text-gray-800 mb-6">Créer une nouvelle tâche</h2>
        
        <form method="post" asp-action="Create" asp-controller="ProjectTasks">
            <input type="hidden" asp-for="ProjectId" />

            <div class="space-y-6">
                <!-- Titre -->
                <div>
                    <label asp-for="Title" class="block text-sm font-medium text-gray-700 mb-2">Titre de la tâche *</label>
                    <input asp-for="Title" required
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition"
                        placeholder="Ex: Intégration de la page d'accueil">
                </div>

                <!-- Description -->
                <div>
                    <label asp-for="Description" class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                    <textarea asp-for="Description" rows="4"
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition resize-none"
                        placeholder="Décrivez la tâche en détail..."></textarea>
                </div>

                <!-- Assignation multiple -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Assigné à</label>
                    <div class="space-y-2">
                        @foreach (var member in Model.ProjectMembers)
                        {
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" name="AssignedUserIds" value="@member.UserId"
                                       class="w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500"
                                       @(Model.AssignedUserIds.Contains(member.UserId) ? "checked" : "")>
                                <span class="text-gray-700">@member.FullName</span>
                            </label>
                        }
                    </div>
                </div>

                <!-- Date d'échéance et Priorité -->
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                    <label asp-for="Deadline" class="block text-sm font-medium text-gray-700 mb-2">Date d'échéance</label>
                    <input asp-for="Deadline" type="date"
                           value="@(Model.Deadline.Year <= 1 ? DateTime.Today.ToString("yyyy-MM-dd") : Model.Deadline.ToString("yyyy-MM-dd"))"
                           class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition">
                </div>

                    <div>
                        <label asp-for="Priority" class="block text-sm font-medium text-gray-700 mb-2">Priorité</label>
                        <select asp-for="Priority" asp-items="priorityList"
                                class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition">
                        </select>
                    </div>
                </div>

                <!-- Statut initial -->
                <div>
                    <label asp-for="Status" class="block text-sm font-medium text-gray-700 mb-2">Statut initial</label>
                    <select asp-for="Status" asp-items="statusList"
                            class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition">
                    </select>
                </div>

                <!-- Boutons -->
                <div class="flex justify-end space-x-4 pt-4 border-t">
                    <a href="@Url.Action("Details", "Projects", new { id = Model.ProjectId })"
                       class="px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition font-medium">
                        Annuler
                    </a>
                    <button type="submit" class="px-6 py-3 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition font-medium">
                        <i class="fas fa-plus mr-2"></i>Créer la tâche
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>